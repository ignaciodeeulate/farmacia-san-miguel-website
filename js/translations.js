// Multilingual translations for Spanish, Basque, and English
const translations = {
    es: {
        // Navigation
        pharmacy_name: "Farmacia San Miguel",
        nav_home: "Inicio",
        nav_products: "Productos",
        nav_services: "Servicios",
        nav_appointments: "Citas",
        nav_contact: "Contacto",
        
        // Hero Section
        hero_title: "Tu salud, nuestra prioridad",
        hero_subtitle: "Farmacia de confianza con más de 30 años cuidando de tu bienestar. Productos de calidad, servicios profesionales y atención personalizada.",
        hero_shop_now: "Comprar Ahora",
        hero_book_appointment: "Reservar Cita",
        hero_card_title: "Servicios de Salud",
        hero_card_desc: "Medición de presión arterial, consultas nutricionales y más",
        
        // Services
        services_title: "Nuestros Servicios",
        services_subtitle: "Servicios profesionales para cuidar tu salud",
        service_click_collect: "Click & Collect",
        service_click_collect_desc: "Haz tu pedido online y recógelo cuando te convenga",
        service_blood_pressure: "Medición de Presión",
        service_blood_pressure_desc: "Control profesional de tu presión arterial",
        service_nutrition: "Consulta Nutricional",
        service_nutrition_desc: "Planes personalizados de alimentación saludable",
        service_consultation: "Consulta General",
        service_consultation_desc: "Asesoramiento farmacéutico personalizado",
        service_learn_more: "Saber Más",
        service_book_now: "Reservar",
        
        // Products
        products_title: "Productos Destacados",
        filter_all: "Todos",
        filter_otc: "Sin Receta",
        filter_vitamins: "Vitaminas",
        filter_skincare: "Cuidado Personal",
        filter_baby: "Bebé",
        view_all_products: "Ver Todos los Productos",
        add_to_cart: "Añadir al Carrito",
        out_of_stock: "Sin Stock",
        low_stock: "Pocas Unidades",
        in_stock: "En Stock",
        
        // Product names and descriptions
        product_paracetamol_name: "Paracetamol 500mg",
        product_paracetamol_desc: "Analgésico y antipirético para dolor y fiebre",
        product_vitamin_c_name: "Vitamina C 1000mg",
        product_vitamin_c_desc: "Suplemento vitamínico para reforzar el sistema inmune",
        product_moisturizer_name: "Crema Hidratante",
        product_moisturizer_desc: "Crema hidratante para piel seca y sensible",
        product_diapers_name: "Pañales Bebé Talla 3",
        product_diapers_desc: "Pañales ultra absorbentes para bebés de 6-10kg",
        product_ibuprofen_name: "Ibuprofeno 400mg",
        product_ibuprofen_desc: "Antiinflamatorio para dolor y inflamación",
        product_multivitamin_name: "Multivitamínico",
        product_multivitamin_desc: "Complejo vitamínico completo para toda la familia",
        
        // Loyalty Program
        loyalty_title: "Programa de Fidelidad",
        loyalty_subtitle: "Gana puntos con cada compra y disfruta de beneficios exclusivos",
        tier_bronze: "Bronce",
        tier_bronze_desc: "0-99 puntos",
        tier_silver: "Plata",
        tier_silver_desc: "100-499 puntos",
        tier_gold: "Oro",
        tier_gold_desc: "500+ puntos",
        loyalty_benefits_title: "Beneficios",
        benefit_1: "1 punto por cada €1 gastado",
        benefit_2: "Descuentos exclusivos",
        benefit_3: "Prioridad en citas",
        benefit_4: "Ofertas personalizadas",
        
        // Cart
        cart_title: "Carrito de Compras",
        cart_total: "Total:",
        points_to_earn: "Puntos a ganar:",
        continue_shopping: "Seguir Comprando",
        proceed_checkout: "Proceder al Pago",
        cart_empty: "Tu carrito está vacío",
        cart_empty_desc: "Añade algunos productos para comenzar",
        
        // Appointments
        appointment_title: "Reservar Cita",
        appointment_service: "Servicio:",
        appointment_date: "Fecha:",
        appointment_time: "Hora:",
        appointment_name: "Nombre completo:",
        appointment_phone: "Teléfono:",
        appointment_email: "Email:",
        appointment_notes: "Notas adicionales:",
        select_service: "Seleccionar servicio",
        select_time: "Seleccionar hora",
        book_appointment: "Reservar Cita",
        cancel: "Cancelar",
        
        // Authentication
        login_title: "Iniciar Sesión",
        login_email: "Email:",
        login_password: "Contraseña:",
        remember_me: "Recordarme",
        forgot_password: "¿Olvidaste tu contraseña?",
        create_account: "Crear cuenta",
        login: "Iniciar Sesión",
        
        // Footer
        footer_description: "Tu farmacia de confianza desde 2003. Comprometidos con tu salud y bienestar.",
        footer_services: "Servicios",
        footer_click_collect: "Click & Collect",
        footer_consultations: "Consultas",
        footer_health_services: "Servicios de Salud",
        footer_loyalty: "Programa de Fidelidad",
        footer_contact: "Contacto",
        footer_hours: "Horarios",
        hours_weekdays: "Lun-Vie: 9:00 - 21:00",
        hours_saturday: "Sábado: 9:00 - 14:00",
        hours_sunday: "Domingo: Cerrado",
        footer_rights: "Todos los derechos reservados.",
        footer_privacy: "Política de Privacidad",
        footer_terms: "Términos y Condiciones",
        footer_cookies: "Política de Cookies",
        
        // Notifications
        added_to_cart: "Producto añadido al carrito",
        appointment_booked: "Cita reservada correctamente",
        error_occurred: "Ha ocurrido un error",
        fill_required_fields: "Por favor, completa todos los campos requeridos",
        
        // Time slots
        morning: "Mañana",
        afternoon: "Tarde",
        available: "Disponible",
        unavailable: "No disponible"
    },
    
    eu: {
        // Navigation
        pharmacy_name: "San Miguel Botika",
        nav_home: "Hasiera",
        nav_products: "Produktuak",
        nav_services: "Zerbitzuak",
        nav_appointments: "Hitzorduak",
        nav_contact: "Kontaktua",
        
        // Hero Section
        hero_title: "Zure osasuna, gure lehentasuna",
        hero_subtitle: "30 urte baino gehiago zure ongizatea zainduz. Kalitate produktuak, zerbitzu profesionalak eta arreta pertsonalizatua.",
        hero_shop_now: "Orain Erosi",
        hero_book_appointment: "Hitzordua Hartu",
        hero_card_title: "Osasun Zerbitzuak",
        hero_card_desc: "Odol-presioa neurtzea, elikadura kontsultak eta gehiago",
        
        // Services
        services_title: "Gure Zerbitzuak",
        services_subtitle: "Zure osasuna zaintzeko zerbitzu profesionalak",
        service_click_collect: "Click & Collect",
        service_click_collect_desc: "Egin zure eskaera online eta jaso nahi duzunean",
        service_blood_pressure: "Odol-presio Neurketa",
        service_blood_pressure_desc: "Zure odol-presioaren kontrol profesionala",
        service_nutrition: "Elikadura Kontsulta",
        service_nutrition_desc: "Elikadura osasungarriaren plan pertsonalizatuak",
        service_consultation: "Kontsulta Orokorra",
        service_consultation_desc: "Farmazia aholkularitza pertsonalizatua",
        service_learn_more: "Gehiago Jakin",
        service_book_now: "Erreserbatu",
        
        // Products
        products_title: "Nabarmendutako Produktuak",
        filter_all: "Denak",
        filter_otc: "Errezeta Gabe",
        filter_vitamins: "Bitaminak",
        filter_skincare: "Gorputz Zaintza",
        filter_baby: "Haurra",
        view_all_products: "Produktu Guztiak Ikusi",
        add_to_cart: "Saskira Gehitu",
        out_of_stock: "Stock Gabe",
        low_stock: "Unitate Gutxi",
        in_stock: "Stockean",
        
        // Product names and descriptions
        product_paracetamol_name: "Paracetamol 500mg",
        product_paracetamol_desc: "Mina eta sukarraren aurkako analgesikoa eta antipiretikoa",
        product_vitamin_c_name: "C Bitamina 1000mg",
        product_vitamin_c_desc: "Immune sistema indartzeko bitamina osagarria",
        product_moisturizer_name: "Krema Hidratatzailea",
        product_moisturizer_desc: "Azal lehor eta sentikorraren krema hidratatzailea",
        product_diapers_name: "Haurren Zapi-oihalak 3. Neurria",
        product_diapers_desc: "6-10kg-ko haurrentzako xurgapen handiko zapi-oihalak",
        product_ibuprofen_name: "Ibuprofeno 400mg",
        product_ibuprofen_desc: "Mina eta hanturarako antiinflamatorioa",
        product_multivitamin_name: "Multibita",
        product_multivitamin_desc: "Familia osorako bitamina konplexu osoa",
        
        // Loyalty Program
        loyalty_title: "Leialtasun Programa",
        loyalty_subtitle: "Irabazi puntuak erosketa bakoitzarekin eta gozatu abantaila esklusiboekin",
        tier_bronze: "Brontze",
        tier_bronze_desc: "0-99 puntu",
        tier_silver: "Zilarra",
        tier_silver_desc: "100-499 puntu",
        tier_gold: "Urrea",
        tier_gold_desc: "500+ puntu",
        loyalty_benefits_title: "Abantailak",
        benefit_1: "Puntu 1 gastaturiko €1 bakoitzeko",
        benefit_2: "Deskontua esklusiboak",
        benefit_3: "Hitzorduetan lehentasuna",
        benefit_4: "Eskaintza pertsonalizatuak",
        
        // Cart
        cart_title: "Erosketa Saskia",
        cart_total: "Guztira:",
        points_to_earn: "Irabazteko puntuak:",
        continue_shopping: "Erosketak Jarraitu",
        proceed_checkout: "Ordainketara Joan",
        cart_empty: "Zure saskia hutsik dago",
        cart_empty_desc: "Gehitu produktu batzuk hasteko",
        
        // Appointments
        appointment_title: "Hitzordua Hartu",
        appointment_service: "Zerbitzua:",
        appointment_date: "Data:",
        appointment_time: "Ordua:",
        appointment_name: "Izen osoa:",
        appointment_phone: "Telefonoa:",
        appointment_email: "Emaila:",
        appointment_notes: "Ohar gehigarriak:",
        select_service: "Zerbitzua hautatu",
        select_time: "Ordua hautatu",
        book_appointment: "Hitzordua Hartu",
        cancel: "Ezeztatu",
        
        // Authentication
        login_title: "Saioa Hasi",
        login_email: "Emaila:",
        login_password: "Pasahitza:",
        remember_me: "Gogoratu",
        forgot_password: "Pasahitza ahaztu duzu?",
        create_account: "Kontua sortu",
        login: "Saioa Hasi",
        
        // Footer
        footer_description: "Zure konfiantzazko botika 2003tik. Zure osasun eta ongizatearekin konprometituta.",
        footer_services: "Zerbitzuak",
        footer_click_collect: "Click & Collect",
        footer_consultations: "Kontsultak",
        footer_health_services: "Osasun Zerbitzuak",
        footer_loyalty: "Leialtasun Programa",
        footer_contact: "Kontaktua",
        footer_hours: "Ordutegia",
        hours_weekdays: "Al-Or: 9:00 - 21:00",
        hours_saturday: "Larunbata: 9:00 - 14:00",
        hours_sunday: "Igandea: Itxita",
        footer_rights: "Eskubide guztiak erreserbatuta.",
        footer_privacy: "Pribatutasun Politika",
        footer_terms: "Baldintzak",
        footer_cookies: "Cookie Politika",
        
        // Notifications
        added_to_cart: "Produktua saskira gehitu da",
        appointment_booked: "Hitzordua ondo erreserbatu da",
        error_occurred: "Errore bat gertatu da",
        fill_required_fields: "Mesedez, bete beharrezko eremu guztiak",
        
        // Time slots
        morning: "Goiza",
        afternoon: "Arratsaldea",
        available: "Eskuragarri",
        unavailable: "Ez eskuragarri"
    },
    
    en: {
        // Navigation
        pharmacy_name: "San Miguel Pharmacy",
        nav_home: "Home",
        nav_products: "Products",
        nav_services: "Services",
        nav_appointments: "Appointments",
        nav_contact: "Contact",
        
        // Hero Section
        hero_title: "Your health, our priority",
        hero_subtitle: "Trusted pharmacy with over 30 years caring for your wellbeing. Quality products, professional services and personalized attention.",
        hero_shop_now: "Shop Now",
        hero_book_appointment: "Book Appointment",
        hero_card_title: "Health Services",
        hero_card_desc: "Blood pressure measurement, nutritional consultations and more",
        
        // Services
        services_title: "Our Services",
        services_subtitle: "Professional services to take care of your health",
        service_click_collect: "Click & Collect",
        service_click_collect_desc: "Place your order online and pick it up when convenient",
        service_blood_pressure: "Blood Pressure Measurement",
        service_blood_pressure_desc: "Professional monitoring of your blood pressure",
        service_nutrition: "Nutritional Consultation",
        service_nutrition_desc: "Personalized healthy eating plans",
        service_consultation: "General Consultation",
        service_consultation_desc: "Personalized pharmaceutical advice",
        service_learn_more: "Learn More",
        service_book_now: "Book Now",
        
        // Products
        products_title: "Featured Products",
        filter_all: "All",
        filter_otc: "Over-the-Counter",
        filter_vitamins: "Vitamins",
        filter_skincare: "Personal Care",
        filter_baby: "Baby",
        view_all_products: "View All Products",
        add_to_cart: "Add to Cart",
        out_of_stock: "Out of Stock",
        low_stock: "Low Stock",
        in_stock: "In Stock",
        
        // Product names and descriptions
        product_paracetamol_name: "Paracetamol 500mg",
        product_paracetamol_desc: "Analgesic and antipyretic for pain and fever",
        product_vitamin_c_name: "Vitamin C 1000mg",
        product_vitamin_c_desc: "Vitamin supplement to strengthen the immune system",
        product_moisturizer_name: "Moisturizing Cream",
        product_moisturizer_desc: "Moisturizing cream for dry and sensitive skin",
        product_diapers_name: "Baby Diapers Size 3",
        product_diapers_desc: "Ultra-absorbent diapers for babies 6-10kg",
        product_ibuprofen_name: "Ibuprofen 400mg",
        product_ibuprofen_desc: "Anti-inflammatory for pain and inflammation",
        product_multivitamin_name: "Multivitamin",
        product_multivitamin_desc: "Complete vitamin complex for the whole family",
        
        // Loyalty Program
        loyalty_title: "Loyalty Program",
        loyalty_subtitle: "Earn points with every purchase and enjoy exclusive benefits",
        tier_bronze: "Bronze",
        tier_bronze_desc: "0-99 points",
        tier_silver: "Silver",
        tier_silver_desc: "100-499 points",
        tier_gold: "Gold",
        tier_gold_desc: "500+ points",
        loyalty_benefits_title: "Benefits",
        benefit_1: "1 point for every €1 spent",
        benefit_2: "Exclusive discounts",
        benefit_3: "Priority appointments",
        benefit_4: "Personalized offers",
        
        // Cart
        cart_title: "Shopping Cart",
        cart_total: "Total:",
        points_to_earn: "Points to earn:",
        continue_shopping: "Continue Shopping",
        proceed_checkout: "Proceed to Checkout",
        cart_empty: "Your cart is empty",
        cart_empty_desc: "Add some products to get started",
        
        // Appointments
        appointment_title: "Book Appointment",
        appointment_service: "Service:",
        appointment_date: "Date:",
        appointment_time: "Time:",
        appointment_name: "Full name:",
        appointment_phone: "Phone:",
        appointment_email: "Email:",
        appointment_notes: "Additional notes:",
        select_service: "Select service",
        select_time: "Select time",
        book_appointment: "Book Appointment",
        cancel: "Cancel",
        
        // Authentication
        login_title: "Sign In",
        login_email: "Email:",
        login_password: "Password:",
        remember_me: "Remember me",
        forgot_password: "Forgot your password?",
        create_account: "Create account",
        login: "Sign In",
        
        // Footer
        footer_description: "Your trusted pharmacy since 1992. Committed to your health and wellbeing.",
        footer_services: "Services",
        footer_click_collect: "Click & Collect",
        footer_consultations: "Consultations",
        footer_health_services: "Health Services",
        footer_loyalty: "Loyalty Program",
        footer_contact: "Contact",
        footer_hours: "Hours",
        hours_weekdays: "Mon-Fri: 9:00 - 21:00",
        hours_saturday: "Saturday: 9:00 - 14:00",
        hours_sunday: "Sunday: Closed",
        footer_rights: "All rights reserved.",
        footer_privacy: "Privacy Policy",
        footer_terms: "Terms and Conditions",
        footer_cookies: "Cookie Policy",
        
        // Notifications
        added_to_cart: "Product added to cart",
        appointment_booked: "Appointment booked successfully",
        error_occurred: "An error occurred",
        fill_required_fields: "Please fill in all required fields",
        
        // Time slots
        morning: "Morning",
        afternoon: "Afternoon",
        available: "Available",
        unavailable: "Unavailable"
    }
};

// Current language state
let currentLanguage = 'es';

// Initialize language from localStorage or browser preference
function initializeLanguage() {
    const savedLanguage = localStorage.getItem('pharmacy-language');
    const browserLanguage = navigator.language.split('-')[0];
    
    if (savedLanguage && translations[savedLanguage]) {
        currentLanguage = savedLanguage;
    } else if (translations[browserLanguage]) {
        currentLanguage = browserLanguage;
    } else {
        currentLanguage = 'es'; // Default to Spanish
    }
    
    updateLanguageButtons();
    translatePage();
}

// Update language button states
function updateLanguageButtons() {
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lang === currentLanguage) {
            btn.classList.add('active');
        }
    });
}

// Translate all elements on the page
function translatePage() {
    const elements = document.querySelectorAll('[data-translate]');
    
    elements.forEach(element => {
        const key = element.dataset.translate;
        const translation = translations[currentLanguage][key];
        
        if (translation) {
            if (element.tagName === 'INPUT' && element.type === 'submit') {
                element.value = translation;
            } else if (element.tagName === 'INPUT' && element.placeholder !== undefined) {
                element.placeholder = translation;
            } else {
                element.textContent = translation;
            }
        }
    });
    
    // Update document title
    document.title = translations[currentLanguage].pharmacy_name + " - " + translations[currentLanguage].hero_title;
    
    // Update HTML lang attribute
    document.documentElement.lang = currentLanguage;
}

// Change language
function changeLanguage(language) {
    if (translations[language]) {
        currentLanguage = language;
        localStorage.setItem('pharmacy-language', language);
        updateLanguageButtons();
        translatePage();
        
        // Trigger custom event for other components
        document.dispatchEvent(new CustomEvent('languageChanged', {
            detail: { language: currentLanguage }
        }));
    }
}

// Get translation for a key
function t(key) {
    return translations[currentLanguage][key] || key;
}

// Add event listeners for language buttons
document.addEventListener('DOMContentLoaded', function() {
    // Initialize language
    initializeLanguage();
    
    // Add click handlers for language buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            changeLanguage(this.dataset.lang);
        });
    });
    
    // Listen for language changes to update dynamic content
    document.addEventListener('languageChanged', function(e) {
        // Update any dynamically generated content
        updateDynamicTranslations();
    });
});

// Update translations for dynamically generated content
function updateDynamicTranslations() {
    // Update product cards if they exist
    updateProductTranslations();
    
    // Update cart if it's open
    updateCartTranslations();
    
    // Update appointment form if it's open
    updateAppointmentTranslations();
}

// Update product-related translations
function updateProductTranslations() {
    // Update stock status
    document.querySelectorAll('.product-stock').forEach(element => {
        const stockLevel = element.dataset.stock;
        if (stockLevel === 'out') {
            element.textContent = t('out_of_stock');
            element.className = 'product-stock stock-out';
        } else if (stockLevel === 'low') {
            element.textContent = t('low_stock');
            element.className = 'product-stock stock-low';
        } else {
            element.textContent = t('in_stock');
            element.className = 'product-stock stock-available';
        }
    });
    
    // Update add to cart buttons
    document.querySelectorAll('.btn-add-cart').forEach(btn => {
        if (!btn.disabled) {
            btn.textContent = t('add_to_cart');
        } else {
            btn.textContent = t('out_of_stock');
        }
    });
}

// Update cart translations
function updateCartTranslations() {
    const cartModal = document.getElementById('cart-modal');
    if (cartModal && cartModal.classList.contains('active')) {
        // Update cart total label
        const totalLabel = cartModal.querySelector('.cart-total span:first-child');
        if (totalLabel) {
            totalLabel.textContent = t('cart_total');
        }
        
        // Update points label
        const pointsLabel = cartModal.querySelector('.loyalty-points-earned span:first-child');
        if (pointsLabel) {
            pointsLabel.textContent = t('points_to_earn');
        }
    }
}

// Update appointment form translations
function updateAppointmentTranslations() {
    const appointmentModal = document.getElementById('appointment-modal');
    if (appointmentModal && appointmentModal.classList.contains('active')) {
        // Update service options
        const serviceSelect = document.getElementById('appointment-service');
        if (serviceSelect) {
            const options = serviceSelect.querySelectorAll('option');
            options[0].textContent = t('select_service');
            options[1].textContent = t('service_blood_pressure');
            options[2].textContent = t('service_nutrition');
            options[3].textContent = t('service_consultation');
        }
        
        // Update time select placeholder
        const timeSelect = document.getElementById('appointment-time');
        if (timeSelect && timeSelect.options.length > 0) {
            timeSelect.options[0].textContent = t('select_time');
        }
    }
}

// Export functions for use in other modules
window.translations = {
    t,
    changeLanguage,
    getCurrentLanguage: () => currentLanguage,
    initializeLanguage,
    translatePage,
    updateDynamicTranslations
};